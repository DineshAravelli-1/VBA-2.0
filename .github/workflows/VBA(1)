Sub WriteListToSharePoint()
    Dim objXML As MSXML2.XMLHTTP60
    Dim SharePointURL As String
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim i As Integer
    Dim j As Integer
    Dim part1 As String, part2 As String, part3 As String, part4 As String
    Dim jsonData As String
    Dim field As String
    Dim value As String
    Dim digestValue As String
    Dim responseText As String

    ' Initialize variables
    SharePointURL = "http://sharepoint3.bankofamerica.com/sites/GBS_GCAOO_AML_Onboarding/F_O_Give_Up_agreement/_api/web/lists/getbytitle('Work_Tracker')/items"
    Set ws = ThisWorkbook.Sheets("UploadDat")  ' Correct sheet name
    
    ' Get the last row with data
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row
    
    ' Get form digest value
    digestValue = GetFormDigest("http://sharepoint3.bankofamerica.com/sites/GBS_GCAOO_AML_Onboarding")
    
    ' Create XMLHTTP object
    Set objXML = New MSXML2.XMLHTTP60
    
    ' Loop through the rows and prepare JSON data
    For i = 2 To lastRow ' Assuming the first row is headers
        part1 = "{"
        part2 = ""
        part3 = ""
        part4 = ""
        
        For j = 1 To 79 ' Assuming there are 79 columns
            field = ws.Cells(1, j).Value  ' Header names are in the first row
            value = Replace(ws.Cells(i, j).Value, """", "\""")  ' Escape quotes in data
            Select Case j
                Case 1 To 20
                    part1 = part1 & """" & field & """:""" & value & """"
                Case 21 To 40
                    part2 = part2 & """" & field & """:""" & value & """"
                Case 41 To 60
                    part3 = part3 & """" & field & """:""" & value & """"
                Case 61 To 79
                    part4 = part4 & """" & field & """:""" & value & """"
            End Select
            If j < 79 Then
                If j = 20 Or j = 40 Or j = 60 Then
                    ' Do not add a comma after these parts
                Else
                    Select Case j
                        Case 1 To 19, 21 To 39, 41 To 59
                            jsonData = jsonData & ", "
                        Case 20, 40, 60
                            ' Do not add a comma after these parts
                    End Select
                End If
            End If
        Next j
        
        jsonData = part1 & part2 & part3 & part4 & "}"
        
        ' Prepare the HTTP request
        objXML.Open "POST", SharePointURL, False
        objXML.setRequestHeader "Content-Type", "application/json;odata=verbose"
        objXML.setRequestHeader "Accept", "application/json;odata=verbose"
        objXML.setRequestHeader "X-RequestDigest", digestValue
        objXML.send jsonData
        
        ' Check the response
        responseText = objXML.responseText
        If objXML.Status = 201 Then
            Debug.Print "Item " & i - 1 & " uploaded successfully!"
        Else
            Debug.Print "Item " & i - 1 & " upload failed. Status: " & objXML.Status & "; Response: " & responseText
            Debug.Print "JSON Data: " & jsonData ' Print the JSON data for debugging
        End If
    Next i
    
    ' Clean up
    Set objXML = Nothing
End Sub
