Sub WriteListToSharePoint()
    Dim objXML As MSXML2.XMLHTTP60
    Dim SharePointURL As String
    Dim ListName As String
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim i As Long
    Dim jsonData As String
    Dim Response As String
    
    ' Initialize variables
    SharePointURL = "https://yoursharepointsite.com/sites/yoursite/_api/web/lists/getbytitle('YourListName')/items"
    ListName = "YourListName"
    Set ws = ThisWorkbook.Sheets("Sheet1") ' Change to your sheet name
    
    ' Get the last row with data
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row
    
    ' Create XMLHTTP object
    Set objXML = New MSXML2.XMLHTTP60
    
    ' Loop through the rows and prepare JSON data
    For i = 2 To lastRow ' Assuming the first row is headers
        jsonData = "{'Title':'" & ws.Cells(i, 1).Value & "', 'FieldName1':'" & ws.Cells(i, 2).Value & "', 'FieldName2':'" & ws.Cells(i, 3).Value & "'}" ' Adjust fields and values accordingly
        
        ' Prepare the HTTP request
        objXML.Open "POST", SharePointURL, False
        objXML.setRequestHeader "Content-Type", "application/json;odata=verbose"
        objXML.setRequestHeader "Accept", "application/json;odata=verbose"
        objXML.setRequestHeader "X-RequestDigest", GetFormDigest(SharePointURL)
        objXML.send jsonData
        
        ' Check the response
        If objXML.Status = 201 Then
            Response = objXML.responseText
            Debug.Print "Item " & i - 1 & " uploaded successfully! Response: " & Response
        Else
            Debug.Print "Item " & i - 1 & " upload failed. Status: " & objXML.Status & " Response: " & objXML.responseText
        End If
    Next i
    
    ' Clean up
    Set objXML = Nothing
End Sub

Function GetFormDigest(SharePointURL As String) As String
    Dim objXML As MSXML2.XMLHTTP60
    Dim strDigest As String

    ' Create XMLHTTP object
    Set objXML = New MSXML2.XMLHTTP60

    ' Prepare the HTTP request to get the form digest value
    objXML.Open "POST", SharePointURL & "/_api/contextinfo", False
    objXML.setRequestHeader "Accept", "application/json;odata=verbose"
    objXML.send ""

    ' Parse the response to get the form digest value
    If objXML.Status = 200 Then
        Dim jsonResponse As Object
        Set jsonResponse = JsonConverter.ParseJson(objXML.responseText)
        strDigest = jsonResponse("d")("GetContextWebInformation")("FormDigestValue")
        GetFormDigest = strDigest
    Else
        MsgBox "Failed to get form digest. Status: " & objXML.Status & " Response: " & objXML.responseText
        GetFormDigest = ""
    End If

    ' Clean up
    Set objXML = Nothing
End Function
